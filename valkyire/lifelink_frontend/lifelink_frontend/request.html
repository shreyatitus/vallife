<!DOCTYPE html>
<html>
<head>
    <title>Request Blood</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="navbar">Blood Request</div>

<div class="container">
    <h2>Request Blood</h2>

    <input type="text" id="patientName" placeholder="Patient Name">
    
    <select id="bloodNeeded">
        <option value="">Select Blood Group</option>
        <option>A+</option>
        <option>B+</option>
        <option>O+</option>
        <option>AB+</option>
        <option>A-</option>
        <option>B-</option>
        <option>O-</option>
        <option>AB-</option>
    </select>

    <input type="text" id="hospital" placeholder="Hospital Name">
    <button type="button" onclick="getLocation()">Get Hospital Location</button>
    <p id="locationStatus"></p>

    <button onclick="createRequest()">Submit Request</button>

    <p id="message"></p>
</div>

<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script>
let reqLat = 0, reqLon = 0;

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                reqLat = position.coords.latitude;
                reqLon = position.coords.longitude;
                document.getElementById("locationStatus").innerText = `Location: ${reqLat.toFixed(4)}, ${reqLon.toFixed(4)}`;
            },
            () => {
                document.getElementById("locationStatus").innerText = "Location access denied";
            }
        );
    } else {
        document.getElementById("locationStatus").innerText = "GPS not supported";
    }
}

async function createRequest() {
    if (!reqLat || !reqLon) {
        document.getElementById("message").innerText = "Please get location first";
        return;
    }
    
    const user = JSON.parse(localStorage.getItem("user"));
    
    const requestData = {
        patientName: document.getElementById("patientName").value,
        blood: document.getElementById("bloodNeeded").value,
        hospital: document.getElementById("hospital").value,
        latitude: reqLat,
        longitude: reqLon,
        user_id: user.id
    };

    const result = await apiRequest("/create-request", "POST", requestData);
    document.getElementById("message").innerText = result.message;
}
</script>

</body>
</html>