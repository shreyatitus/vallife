<!DOCTYPE html>
<html>
<head>
    <title>Register - LifeLink</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

<div class="card">
    <h2>Donor Registration</h2>

    <input type="text" id="name" placeholder="Full Name">
    <input type="email" id="email" placeholder="Email">
    <input type="text" id="phone" placeholder="Phone">

    <select id="blood">
        <option value="">Select Blood Group</option>
        <option>A+</option>
        <option>B+</option>
        <option>O+</option>
        <option>AB+</option>
        <option>A-</option>
        <option>B-</option>
        <option>O-</option>
        <option>AB-</option>
    </select>

    <button type="button" onclick="getLocation()">Get My Location</button>
    <p id="locationStatus"></p>
    <input type="password" id="password" placeholder="Password">

    <button class="btn btn-primary" onclick="register()">Register</button>

    <div class="message" id="message"></div>
</div>

<script src="js/config.js"></script>
<script src="js/api.js"></script>
<script>
let userLat = 0, userLon = 0;

function getLocation() {
    if (navigator.geolocation) {
        navigator.geolocation.getCurrentPosition(
            (position) => {
                userLat = position.coords.latitude;
                userLon = position.coords.longitude;
                document.getElementById("locationStatus").innerText = `Location captured: ${userLat.toFixed(4)}, ${userLon.toFixed(4)}`;
            },
            () => {
                document.getElementById("locationStatus").innerText = "Location access denied";
            }
        );
    } else {
        document.getElementById("locationStatus").innerText = "GPS not supported";
    }
}

async function register() {
    if (!userLat || !userLon) {
        document.getElementById("message").innerText = "Please get your location first";
        return;
    }
    
    const userData = {
        name: document.getElementById("name").value,
        email: document.getElementById("email").value,
        phone: document.getElementById("phone").value,
        blood: document.getElementById("blood").value,
        latitude: userLat,
        longitude: userLon,
        password: document.getElementById("password").value
    };

    const result = await apiRequest("/register", "POST", userData);
    document.getElementById("message").innerText = result.message || "Registration successful!";
}
</script>

</body>
</html>